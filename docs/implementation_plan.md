# 実装計画書

## 1. 開発フェーズ概要

### 1.1 フェーズ構成
本プロジェクトは以下の4つのフェーズで段階的に実装を進める：

- **Phase 1**: 基盤構築（認証・DB・基本UI）
- **Phase 2**: 公式サイト対応（スクレイピング・商品管理）
- **Phase 3**: API統合（楽天・Yahoo）
- **Phase 4**: 高度機能・最適化

### 1.2 開発期間目安
- **Phase 1**: 2-3週間
- **Phase 2**: 3-4週間
- **Phase 3**: 3-4週間
- **Phase 4**: 2-3週間
- **合計**: 10-14週間

## 2. Phase 1: 基盤構築

### 2.1 目的
開発環境の構築とシステムの基礎となるデータベース、基本UIを構築

### 2.2 実装項目

#### 2.2.1 開発環境構築
- **優先度**: 最高
- **依存関係**: なし
- **実装内容**:
  1. Next.js 15プロジェクト初期化
  2. GitHubリポジトリ作成・初期コミット
  3. ドキュメントアップロード
     - 要件定義書
     - 技術仕様書
     - システム設計書
     - 開発ガイドライン
     - 実装計画書
     - README.md
     - CLAUDE.md
  4. Serena MCP初期設定
     - プロジェクトルートでSerena設定
     - 初回インデックス作成
     - .serenaディレクトリを.gitignoreに追加
  5. TypeScript設定
  6. ESLint・Prettier設定
  7. Tailwind CSS設定
  8. shadcn/ui導入・初期コンポーネント取り込み
  9. 環境変数設定

#### 2.2.2 共通プロキシ設定実装
- **優先度**: 最高
- **依存関係**: 開発環境構築
- **実装内容**:
  - プロキシ判定ロジック実装
  - USE_PROXY環境変数による完全制御
  - 事前判定必須ロジック
  - プロキシ設定の一元管理
  - Puppeteerへのプロキシ適用
  - エラーハンドリング

#### 2.2.3 データベース設計・構築
- **優先度**: 最高
- **依存関係**: 開発環境構築
- **実装内容**:
  - Supabaseプロジェクト作成
  - テーブル定義
    - shop_categories
    - products
    - asins
    - product_asins
    - shop_discounts
    - api_settings
  - トリガー設定（updated_at自動更新）
  - インデックス作成

#### 2.2.4 基本レイアウト実装
- **優先度**: 高
- **依存関係**: データベース構築
- **実装内容**:
  - ルートレイアウト作成
  - サイドバーコンポーネント
  - ヘッダーコンポーネント
  - ナビゲーション構造実装（4階層対応）
  - 折りたたみ機能
  - レスポンシブ対応

#### 2.2.5 共通UIコンポーネント
- **優先度**: 高
- **依存関係**: 基本レイアウト
- **実装内容**:
  - shadcn/ui基本コンポーネント導入
    - Button, Input, Table, Dialog, Select, Checkbox
  - Loading コンポーネント
  - ErrorBoundary コンポーネント
  - Toast通知システム

### 2.3 成果物
- 完全な開発環境
- GitHubリポジトリ
- プロジェクトドキュメント一式
- Serena MCP設定済み環境
- 共通プロキシ設定
- データベーススキーマ
- 基本UI・ナビゲーション

### 2.4 検証項目
- [ ] Next.jsアプリが起動する
- [ ] GitHubにコミット・プッシュ可能
- [ ] 全ドキュメントがリポジトリに配置済み
- [ ] Serena MCPが動作する
- [ ] プロキシ設定が正常に動作（USE_PROXY制御）
- [ ] データベース接続確認
- [ ] サイドバーが正常に動作

## 3. Phase 2: 公式サイト対応

### 3.1 目的
公式サイトのスクレイピング機能と商品管理機能を実装

### 3.2 実装項目

#### 3.2.1 商品テーブルコンポーネント
- **優先度**: 最高
- **依存関係**: Phase 1完了
- **実装内容**:
  - 固定ヘッダー付きスクロールテーブル
  - 全列の実装（画像、商品名、価格、ASIN情報等）
  - ソート機能
  - インライン編集機能
  - 画像プレビュー機能
  - チェックボックス・数値入力対応

#### 3.2.2 商品管理機能
- **優先度**: 最高
- **依存関係**: 商品テーブル
- **実装内容**:
  - 商品一覧表示
  - 商品検索・フィルタリング
  - 商品情報編集（インライン）
  - 商品コピー機能
  - 商品削除機能

#### 3.2.3 VT Cosmeticsスクレイピング
- **優先度**: 最高
- **依存関係**: 商品管理機能
- **実装内容**:
  - Puppeteerセットアップ
  - VT固有スクレイパー実装
  - プロキシ制御実装
  - エラーハンドリング
  - 商品重複チェック
  - スクレイピングAPI実装
  - UI：スクレイピング実行ボタン

#### 3.2.4 DHCスクレイピング
- **優先度**: 高
- **依存関係**: VTスクレイピング
- **実装内容**:
  - DHC固有スクレイパー実装
  - 共通化可能な処理の抽出
  - スクレイピングAPI実装

#### 3.2.5 innisfreeスクレイピング
- **優先度**: 高
- **依存関係**: DHCスクレイピング
- **実装内容**:
  - innisfree固有スクレイパー実装
  - スクレイピングAPI実装

#### 3.2.6 ASIN管理機能
- **優先度**: 高
- **依存関係**: 商品管理機能
- **実装内容**:
  - ASIN一覧表示
  - ASIN作成・編集・削除
  - ASIN一括アップロード（Excel/CSV）
  - 商品とASIN紐付け機能
  - ASINフィールド編集（手数料率、FBA料等）

#### 3.2.7 利益計算機能
- **優先度**: 高
- **依存関係**: ASIN管理機能
- **実装内容**:
  - 利益額計算ロジック
  - 利益率計算ロジック
  - ROI計算ロジック
  - リアルタイム計算
  - 割引設定反映

### 3.3 成果物
- 公式サイト3店舗のスクレイピング機能
- 商品管理・編集機能
- ASIN管理機能
- 利益計算機能

### 3.4 検証項目
- [ ] VT/DHC/innisfreeのスクレイピングが正常動作
- [ ] 商品データが正しく保存される
- [ ] 商品テーブルの全機能が動作
- [ ] ASINの紐付けが正常動作
- [ ] 利益計算が正確

## 4. Phase 3: API統合

### 4.1 目的
楽天市場APIとYahoo!ショッピングAPIの統合

### 4.2 実装項目

#### 4.2.1 楽天市場API統合基盤
- **優先度**: 最高
- **依存関係**: Phase 2完了
- **実装内容**:
  - 楽天APIクライアント実装
  - 認証処理
  - 商品検索API実装
  - レスポンス変換処理
  - エラーハンドリング

#### 4.2.2 楽天ショップ設定機能
- **優先度**: 最高
- **依存関係**: 楽天API基盤
- **実装内容**:
  - ショップ設定画面
  - 表示名・shopCode・genreId・キーワード入力
  - 設定保存・読み込み
  - バリデーション

#### 4.2.3 楽天ブランドページ実装
- **優先度**: 高
- **依存関係**: 楽天ショップ設定
- **実装内容**:
  - 無印良品ページ
  - VT Cosmeticsページ
  - innisfreeページ
  - 各ページでの商品取得・表示
  - API実行ボタン

#### 4.2.4 Yahoo!ショッピングAPI統合基盤
- **優先度**: 高
- **依存関係**: 楽天API統合完了
- **実装内容**:
  - Yahoo APIクライアント実装
  - 認証処理
  - 商品検索API実装
  - レスポンス変換処理

#### 4.2.5 Yahooショップ階層実装
- **優先度**: 高
- **依存関係**: Yahoo API基盤
- **実装内容**:
  - LOHACOページ
    - LOHACO-DHCページ
    - LOHACO-VTページ
  - ZOZOTOWNページ
    - ZOZOTOWN-DHCページ
    - ZOZOTOWN-VTページ
  - Yahoo直販-VTページ

#### 4.2.6 カテゴリ一覧ページ実装
- **優先度**: 中
- **依存関係**: 各API統合完了
- **実装内容**:
  - 公式サイト一覧ページ
  - 楽天市場一覧ページ
  - Yahoo!ショッピング一覧ページ
  - 各カテゴリの統計表示
  - ショップカード表示

### 4.3 成果物
- 楽天市場API統合
- Yahoo!ショッピングAPI統合
- 階層型ショップページ
- カテゴリ一覧ページ

### 4.4 検証項目
- [ ] 楽天APIで商品取得可能
- [ ] Yahoo APIで商品取得可能
- [ ] 各ブランドページが正常動作
- [ ] 階層ナビゲーションが正常動作
- [ ] 商品データが統一形式で保存

## 5. Phase 4: 高度機能・最適化

### 5.1 目的
認証機能の実装とシステムの完成度を高め、パフォーマンス最適化と運用機能を追加

### 5.2 実装項目

#### 5.2.1 認証システム実装
- **優先度**: 最高
- **依存関係**: Phase 3完了
- **実装内容**:
  - Google OAuth設定
  - Supabase Auth統合
  - ログインページ実装
  - 認証コールバック処理
  - セッション管理（1ヶ月保持）
  - 認証ガード実装
  - 全ページへの認証保護適用

#### 5.2.2 全体設定機能
- **優先度**: 高
- **依存関係**: 認証システム
- **実装内容**:
  - 表示設定（デフォルト表示列、列幅）
  - ソート設定（初期ソート列・方向）
  - システム設定（アカウント情報）
  - 設定の保存・読み込み
  - 各ページへの設定適用

#### 5.2.3 割引設定機能
- **優先度**: 高
- **依存関係**: 全体設定機能
- **実装内容**:
  - ショップ別割引設定画面
  - パーセンテージ割引
  - 固定額割引
  - 有効/無効切り替え
  - 利益計算への反映

#### 5.2.4 ホーム（ダッシュボード）実装
- **優先度**: 中
- **依存関係**: 認証システム
- **実装内容**:
  - グローバルサマリーカード
  - ショップ別概要テーブル
  - 最近のアクティビティ
  - 利益トレンドチャート
  - クイックアクションボタン

#### 5.2.5 パフォーマンス最適化
- **優先度**: 中
- **依存関係**: 全機能実装完了
- **実装内容**:
  - テーブル仮想化（大量データ対応）
  - 画像遅延ロード最適化
  - API レスポンスキャッシュ
  - バルクデータ更新最適化
  - データベースクエリ最適化

#### 5.2.6 エラーハンドリング強化
- **優先度**: 中
- **依存関係**: 全機能実装完了
- **実装内容**:
  - グローバルエラーハンドラー
  - スクレイピングエラー詳細表示
  - リトライ機能
  - エラーログ記録
  - ユーザーフレンドリーなエラーメッセージ

#### 5.2.7 運用機能
- **優先度**: 低
- **依存関係**: Phase 4の他機能
- **実装内容**:
  - 開発ログ表示機能
  - データエクスポート機能
  - 一括操作機能（商品削除等）
  - システム情報表示

### 5.3 成果物
- 認証システム
- 完全な設定管理機能
- ダッシュボード
- パフォーマンス最適化
- 運用機能

### 5.4 検証項目
- [ ] Google認証でログイン可能
- [ ] セッションが1ヶ月保持される
- [ ] 未認証時はログインページにリダイレクト
- [ ] 全体設定が各ページに反映される
- [ ] 割引設定が利益計算に反映される
- [ ] ダッシュボードが統計を正しく表示
- [ ] 数万件の商品でもスムーズに動作
- [ ] エラーが適切に処理・表示される

## 6. 次のステップ

### 6.1 開発開始前の準備
1. 開発環境セットアップ
2. Supabaseプロジェクト作成
3. Google OAuth設定
4. 楽天・Yahoo API申請・取得
5. プロキシサーバー準備（必要に応じて）

### 6.2 Phase 1開始タスク
1. Next.js 15プロジェクト作成
2. GitHubリポジトリ作成・初期push
3. ドキュメント一式アップロード
4. Serena MCP設定
5. TypeScript・ESLint・Prettier設定
6. Tailwind CSS + shadcn/ui設定
7. 共通プロキシ設定実装
8. データベーススキーマ作成

---

**この実装計画に従って、段階的に確実な開発を進めましょう！**